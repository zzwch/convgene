if(missing(x)) {
if(clipr::clipr_available()){
x <- clipr::read_clip()
}else{
stop("system clipboard is not available")
}
}
geneList <-
stringr::str_split( # split by space
stringr::str_squish( # squish multiple sapces into one space
stringr::str_replace_all( # replace all non-symbol-charactor with a space
x, REGEX, " ")
), " ")
names(geneList) <- names(x) # set names if available
if(!as_list) {
geneList <- unlist(geneList)
if(anyDuplicated(geneList)){
message("returned gene list is redundant! you may use unique() to deduplicate it.")
}
}else{
dup_ind <- which(sapply(geneList, anyDuplicated) > 0)
if(length(dup_ind)>0){
dup_ind <- paste(dup_ind, collapse = ', ')
message(stringr::str_glue("There are duplicated genes in list of index {dup_ind}"))
}
}
if(print) print(geneList)
if(to_clipboard) suppressWarnings(clipr::write_clip(geneList)) else return(geneList)
}
str_to_gene(x = "Runx1, Gata4 Gata1;, Dll4, Nkx2-5, NOTAGENE", to_clipboard = T, as_list = T)
library(ggplot2)
library(convgene)
library(convgene)
library(convgene)
library(convgene)
devtools::load_all(".")
library(convgene)
library(convgene)
library(convgene)
remove.packages("convgene2")
remove.packages("convgene")
library(convgene)
library(convgene)
library(convgene)
library(convgene)
profvis::profvis({library(magrittr)})
mh <- read.table(file = "data/HOM_MouseHumanSequence.rpt", sep = "\t", header = T)
View(mh)
unique(mh$HomoloGene.ID)
all <- read.table(file = "data/HOM_AllOrganism.rpt", sep = "\t", header = T)
all <- read.table(file = "data/HOM_AllOrganism.rpt", sep = "\t", header = T, check.names = F)
all <- read.table(file = "data/HOM_AllOrganism.rpt", sep = "\t", header = T, comment.char = "")
all <- read.table(file = "data/HOM_AllOrganism.rpt", sep = "\t", header = T, quote = "")
View(all)
unique(all$HomoloGene.ID)
all_mh <- subset(all, all$Common.Organism.Name %in% c("human", "mouse, laboratory"))
View(all_mh)
unique(all_mh$HomoloGene.ID)
unique(mh$HomoloGene.ID)
identical(all_mh$HomoloGene.ID, mh$HomoloGene.ID)
View(all_mh)
View(mh)
%||%
x %||% 1
9/36
sessionInfo()
library(devtools)
library(tidyverse)
library(fs)
dir_info()
use_mit_license("Zongcheng Li")
use_testthat()
use_test('pl.dotplot')
library(testthat)
test()
use_package("ggplot2")
use_readme_rmd()
use_devtools()
has_devel()
Seurat
mat <- matrix(1:100, 10)
mat
View(mat)
apply(mat, 1, function(x) {cor(x, mat[10,])})
tmp <- runif(100)
hist(tmp)
hist(tmp, breaks = 100)
rm(list = ls())
library(available)
install.packages("available")
available::available("convgene")
usethis::use_vignette()
usethis::use_vignette("convgene-vignette")
install.packages("printr")
install.packages("pander")
pander::pandoc.table(iris[1:3,1:4])
printr::printr(iris[1:3,1:4])
knitr::kable(iris[1:3,1:3])
knitr::kable(table(1:5,5:10))
knitr::kable(table(1:5, 5:10))
table(1:5, 5:10)
table(1:5, 6:10)
knitr::kable(table(1:5, 6:10))
pander::pandoc.table(table(1:5, 6:10))
expect_equal(10, 10 + 1e-7)
expect_identical(10, 10 + 1e-7)
list(1:10, letters)
str(list(1:10, letters))
expect_output(str(a), "List of 2")
a <- list(1:10, letters)
expect_output(str(a), "List of 2")
expect_output(str(a), "int [1:10]", fixed = TRUE)
search()
use_data_raw()
use_data
tmp$a <- function(x) {1}
tmp <- list()
tmp$a <- function(x) {1}
tmp$a()
a <- tmp$a
summariseOptions = list(
method = c("mean", "median"),
log_base = "log",
do_in_log = F,
outlier_cutoff = 1)
getOption(summariseOptions)
summariseOptions = list(
method = c(base::mean, stat::median),
log_base = "log",
do_by_log = F,
outlier_cutoff = 1)
summariseOptions = list(
method = c(base::mean, stats::median),
log_base = "log",
do_by_log = F,
outlier_cutoff = 1)
summariseOptions$method
summariseOptions$method[[2]]
summariseOptions$method[[2]](1:10)
exp(1)
power(2)
??pow
tmp <- base::mean
tmp[1]
tmp
c(tmp, tmp)
tmp【【1
tmp[[1]]
quantile(1:10, probs = 0.99)
quantile(1:10, probs = 1)
tmp <- -1:-10
tmp
tmp[tmp>0]
quantile(tmp[tmp>0], 1)
which(quantile(tmp[tmp>0], 1))
tmp <- factor(letters)
tmp
setdiff("a", tmp)
setdiff(c(5,3,2,7), 2)
devtools::load_all(".")
load("D:/Project_hEC/200413_Preparation_for_Nature/data_STRT-seq/200227_humanec_data/200227.ec_used.analysis.Rdata")
pl_dotplot(data = ec_used@data,features = c("PECAM1", "PTPRC"), group_by = ec_used@meta.data$Cluster, title = "haha")
devtools::load_all(".")
pl_dotplot(data = ec_used@data,features = c("PECAM1", "PTPRC"), group_by = ec_used@meta.data$Cluster, title = "haha")
devtools::load_all(".")
pl_dotplot(data = ec_used@data,features = c("PECAM1", "PTPRC"), group_by = ec_used@meta.data$Cluster, title = "haha")
use_dev_version()
use_package("ggplot2")
devtools::load_all(".")
pl_dotplot(data = ec_used@data,features = c("PECAM1", "PTPRC"), group_by = ec_used@meta.data$Cluster, title = "haha")
is.na(NA)
is.na(NA) | is.na(NULL)
is.na(NA) | is.na(NULL) == TRUE
is.na(NA) | is.na(NULL) == FALSE
is.na(NA) | is.null(NULL) == FALSE
is.na(NA) | is.null(NULL)
is.na(NA,NA) | is.null(NULL)
is.na(c(NA,NA)) | is.null(c(NULL, NULL))
devtools::load_all(".")
pl_dotplot(data = ec_used@data,features = c("PECAM1", "PTPRC"), group_by = ec_used@meta.data$Cluster, title = "haha")
devtools::load_all(".")
pl_dotplot(data = ec_used@data,features = c("PECAM1", "PTPRC"), group_by = ec_used@meta.data$Cluster, title = "haha")
is.na(NULL) | is.null(NULL)
is.na(NULL)
is.null(NULL) | is.na(NULL)
is.null(NULL)
is.null(NULL) | is.na(NULL)
is.null(NULL) || is.na(NULL)
x[1]
NULL[1]
NULL[[1]]
is.na(NA) || is.null(NA)
is.na(NULL) || is.null(NA)
is.na(NULL)
is.na(NULL) || is.null(NULL)
is.na(NULL) || is.null(NA)
is.null(NA)
is.na(NULL) || is.null(NA)
is.na(NULL)
is.null(NA)||is.na(NULL)
is.null(NA) || is.na(NULL)
is.null(NA)
is.null(NA) || is.na(NULL)
is.na(NULL)
is.null(NA)
devtools::load_all(".")
pl_dotplot(data = ec_used@data,features = c("PECAM1", "PTPRC"), group_by = ec_used@meta.data$Cluster, title = "haha")
devtools::load_all(".")
pl_dotplot(data = ec_used@data,features = c("PECAM1", "PTPRC"), group_by = ec_used@meta.data$Cluster, title = "haha")
devtools::load_all(".")
pl_dotplot(data = ec_used@data,features = c("PECAM1", "PTPRC"), group_by = ec_used@meta.data$Cluster, title = "haha")
devtools::load_all(".")
pl_dotplot(data = ec_used@data,features = c("PECAM1", "PTPRC"), group_by = ec_used@meta.data$Cluster, title = "haha")
devtools::load_all(".")
pl_dotplot(data = ec_used@data,features = c("PECAM1", "PTPRC"), group_by = ec_used@meta.data$Cluster, title = "haha")
devtools::load_all(".")
devtools::load_all(".")
pl_vioboxplot(ec_used@meta.data, x = "Cluster", y = "S_Score")
colnames(ec_used@meta.data)
pl_vioboxplot(ec_used@meta.data, x = "Cluster", y = "S.Score")
devtools::load_all(".")
pl_vioboxplot(ec_used@meta.data, x = "Cluster", y = "S.Score")
exp(1)
e^1
eexp^1
exp^1
class(ec_used@data)
ec_used@data[,1:5,drop = F]
ec_used@data[,1,drop = F]
scale(ec_used@data[1:5, 1:5])
ec_used@data[1:5, 1:5]
2^ec_used@data[1:5, 1:5]
devtools::load_all(".")
pl_stackedViolinPlot
devtools::load_all(".")
data <- ec_used@data
group_by <- ec_used@meta.data$Cluster
pl_stackedViolinPlot(data, group_by, features = c("PECAM1", "CDH5","PTPRC"))
devtools::load_all(".")
pl_stackedViolinPlot(data, group_by, features = c("PECAM1", "CDH5","PTPRC"))
devtools::load_all(".")
pl_stackedViolinPlot(data, group_by, features = c("PECAM1", "CDH5","PTPRC"))
devtools::load_all(".")
pl_stackedViolinPlot(data, group_by, features = c("PECAM1", "CDH5","PTPRC"))
debug(pl_stackedViolinPlot)
pl_stackedViolinPlot(data, group_by, features = c("PECAM1", "CDH5","PTPRC"))
View(ggData)
cbind(t(as.matrix(data[features,,drop = F])),
Group = group_by)
reshape2::melt(cbind(t(as.matrix(data[features,,drop = F])),
Group = group_by),
id.vars = "Group", measure.vars = features,
variable.name = 'Gene',value.name = 'Expression')
melt(cbind(t(as.data.frame(as.matrix(data[features,,drop = F]))),
Group = group_by),
id.vars = "Group", measure.vars = features,
variable.name = 'Gene',value.name = 'Expression') %>% head
melt(cbind(t(as.data.frame(as.matrix(data[features,,drop = F])),
Group = group_by)),
id.vars = "Group", measure.vars = features,
variable.name = 'Gene',value.name = 'Expression') %>% head
melt(as.data.frame(cbind(t(as.matrix(data[features,,drop = F])),
Group = group_by)),
id.vars = "Group", measure.vars = features,
variable.name = 'Gene',value.name = 'Expression') %>% head
melt(as.data.frame(cbind(t(as.matrix(data[features,,drop = F])),
Group = group_by)),
id.vars = "Group", measure.vars = features,
variable.name = 'Gene',value.name = 'Expression') %>% head
features <- c("PECAM1", "CDH5", "PTPRC")
t(data[features,,drop = F])
devtools::load_all(".")
pl_stackedViolinPlot(data, group_by, features = c("PECAM1", "CDH5","PTPRC"))
group_by
droplevels(1:5)
devtools::load_all(".")
pl_stackedViolinPlot(data, group_by, features = c("PECAM1", "CDH5","PTPRC"))
groups
group_by
setdiff("a",group_by)
setdiff("brEC",group_by)
debug(pl_stackedViolinPlot)
pl_stackedViolinPlot(data, group_by, features = c("PECAM1", "CDH5","PTPRC"))
group_by_()
group_by
group_by
View(ggData)
as.data.frame(
cbind(t(as.matrix(data[features,,drop = F])),
Group = group_by)
) %>% head
group_by
as.data.frame(
cbind(t(as.matrix(data[features,,drop = F])),
Group = group_by)
)
cbind(as.data.frame(
t(as.matrix(data[features,,drop = F]))),
Group = group_by)
devtools::load_all(".")
pl_stackedViolinPlot(data, group_by, features = c("PECAM1", "CDH5","PTPRC"))
devtools::load_all(".")
devtools::load_all(".")
pl_stackedViolinPlot(data, group_by, features = c("PECAM1", "CDH5","PTPRC"))
devtools::load_all(".")
pl_stackedViolinPlot(data, group_by, features = c("PECAM1", "CDH5","PTPRC"))
devtools::load_all(".")
devtools::load_all(".")
pl_stackedViolinPlot(data, group_by, features = c("PECAM1", "CDH5","PTPRC"))
devtools::load_all(".")
pl_stackedViolinPlot(data, group_by, features = c("PECAM1", "CDH5","PTPRC"))
devtools::load_all(".")
pl_stackedViolinPlot(data, group_by, features = c("PECAM1", "CDH5","PTPRC"))
devtools::load_all(".")
pl_stackedViolinPlot(data, group_by, features = c("PECAM1", "CDH5","PTPRC"))
pl_stackedViolinPlot(data, group_by, features = c("PECAM1", "CDH5","PTPRC"), fill_colors = Seurat::DiscretePalette(11))
pl_stackedViolinPlot(data, group_by, features = c("PECAM1", "CDH5","PTPRC"), fill_colors = Seurat::DiscretePalette(12))
is.null(Seurat::DiscretePalette(12))
is.na(Seurat::DiscretePalette(12))
devtools::load_all(".")
pl_stackedViolinPlot(data, group_by, features = c("PECAM1", "CDH5","PTPRC"), fill_colors = Seurat::DiscretePalette(12))
devtools::load_all(".")
usethis::use_data(data, overwrite = TRUE)
devtools::load_all(".")
save(ec_used, data, features, group_by, ec_cluster_color, file = "testdata.Rdata")
getwd()
devtools::load_all(".")
expect_success(pl_dotplot(data, features, group_by, groups = c("brEC","unEC",'liEC')))
expect_success(pl_dotplot(data, features, group_by, groups = c("brEC","unEC",'liEC')))
devtools::load_all(".")
expect_success(pl_dotplot(data, features, group_by, groups = c("brEC","unEC",'liEC')))
devtools::load_all(".")
expect_success(pl_dotplot(data, features, group_by, groups = c("brEC","unEC",'liEC')))
devtools::load_all(".")
expect_success(pl_dotplot(data, features, group_by, groups = c("brEC","unEC",'liEC')))
devtools::load_all(".")
expect_success(pl_dotplot(data, features, group_by, groups = c("brEC","unEC",'liEC')))
devtools::load_all(".")
expect_success(pl_dotplot(data, features, group_by, groups = c("brEC","unEC",'liEC')))
pl_dotplot(data, features, group_by, groups = c("brEC","unEC",'liEC'))
devtools::load_all(".")
devtools::load_all(".")
pl_dotplot(data, features, group_by, groups = c("brEC","unEC",'liEC'))
debug(pl_dotplot)
pl_dotplot(data, features, group_by, groups = c("brEC","unEC",'liEC'))
devtools::load_all(".")
pl_dotplot(data, features, group_by, groups = c("brEC","unEC",'liEC'))
debug(pl_dotplot)
pl_dotplot(data, features, group_by, groups = c("brEC","unEC",'liEC'))
data
pl_dotplot(data, features, group_by, groups = c("brEC","unEC",'liEC'))
devtools::load_all(".")
pl_dotplot(data, features, group_by, groups = c("brEC","unEC",'liEC'))
devtools::load_all(".")
pl_dotplot(data, features, group_by, groups = c("brEC","unEC",'liEC'))
devtools::load_all(".")
devtools::load_all(".")
expect_success(pl_dotplot(data, features, group_by, groups = c("brEC","unEC",'liEC')))
capture_expectation(pl_dotplot(data, features, group_by, groups = c("brEC","unEC",'liEC')))
expect_equal(pl_dotplot(data, features, group_by, groups = c("brEC","unEC",'liEC')), NULL)
test_file("tests/testthat/test-pl.R")
test_file("tests/testthat/test-pl.R")
devtools::load_all(".")
library(convgene)
library(convgene)
test_file("tests/testthat/test-pl.R")
pl_dotplot(data, features, group_by, groups = c("brEC","unEC",'liEC'))
devtools::load_all(".")
pl_stackedViolinPlot(data, features, group_by)
devtools::load_all(".")
pl_averageHeatmap(data, features, group_by)
devtools::load_all(".")
devtools::load_all(".")
pl_averageHeatmap(data, features, group_by)
pl_averageHeatmap(data, features, group_by)
devtools::load_all(".")
pl_averageHeatmap(data, features, group_by)
devtools::load_all(".")
pl_averageHeatmap(data, features, group_by)
knitr::kable(table(ec_used@meta.data$Cluster))
knitr::kable(table(ec_used@meta.data$Cluster, ec_used@meta.data$Batch))
pander::pandoc.table(table(ec_used@meta.data$Cluster, ec_used@meta.data$Batch))
knitr::kable(table(ec_used@meta.data$Cluster, ec_used@meta.data$Batch))
knitr::kable
.
879*9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999*
/'00  7...............................................
knitr::kable(ec_used@meta.data[1:5,])
knitr::kable(ec_used@meta.data[1:5,1:10])
ec_used@meta.data[1:5,1:10]
pander::pandoc.table(ec_used@meta.data[1:5,1:5])
devtools::load_all(".")
expect_error(pl_averageHeatmap(data, features, group_by, groups = c("brEC","unEC",'liEC')))
expect_error(pl_averageHeatmap(data, features, group_by, groups = c("brEC","unEC",'liEC'), show_rownames = T))
test_that("pl_averageHeatmap", {
expect_error(pl_averageHeatmap(data, features, group_by, groups = c("brEC","unEC",'liEC'), show_rownames = T))
})
test_that("pl_averageHeatmap", {
expect_error(pl_averageHeatmap(data, features, group_by, groups = c("brEC","unEC",'liEC'), show_rownames = T), NA)
})
expect_error(pl_averageHeatmap(data, features, group_by, groups = c("brEC","unEC",'liEC'), show_rownames = T), NA)
tableHeatmap(ec_used@meta.data[1:5, 1:5])
devtools::load_all(".")
tableHeatmap(ec_used@meta.data[1:5, 1:5])
pl_tableHeatmap(ec_used@meta.data[1:5, 1:5])
print(load("./testdata.Rdata"))
print(load("./tests/testthat/testdata.Rdata"))
meta_data <- ec_used@meta.data
save(ec_used, data, meta_data, features, group_by, ec_cluster_color, file = "tests/testthat/testdata.Rdata")
expect_error(pl_tableHeatmap(table(meta_data$Cluster, meta_data$Batch)), NA)
pl_tableHeatmap(table(meta_data$Cluster, meta_data$Batch))
p <- ggplot(ggTab, mapping = aes_(x = as.name(xx), y = as.name(yy))) +
geom_tile(mapping = aes(fill = log(value+1)
#, height = sqrt((value+1)/max(value)), width = sqrt((value+1)/max(value))
),
color = "grey",
show.legend = T) +
#geom_tile(fill = NA, color = "grey") +
labs(title = title, x = xlab, y = ylab) +
geom_text(mapping = aes(label = value),
data = subset(ggTab, !is.na(ggTab$value)),
color = ifelse(ggTab$value[!is.na(ggTab$value)] >= min, "black", "grey")) +
scale_fill_gradientn(colours = colours, na.value = "white") +
theme_classic() +
theme(axis.text.x = element_text(angle = 45, hjust = 1),
axis.line = element_blank(),
panel.border = element_rect(linetype = 1, color = "black", fill = NA))
colorRampPalette(c("grey", "red"))
colorRampPalette(c("grey", "red"))(5)
colorRamp(c("grey", "red"))(5)
colorRamp(c("grey", "red"))
colorRamp(c("grey", "red"))(5)
colorRamp(c("grey", "red"))(2)
colorRampPalette(c("grey", "red"))(2)
devtools::load_all(".")
library(convgene)
pl_averageHeatmap()
use_package("RColorBrewer")
use_package(pheatmap)
use_package("pheatmap")
use_package("stringr", reshape2)
use_package("stringr", "reshape2")
use_package("stringr")
use_package("reshape2")
devtools::load_all(".")
library(convgene)
RColorBrewer::brewer.pal.info
devtools::load_all(".")
tl_crossTableEnrichment(table(meta_data$Cluster, meta_data$Batch))
tl_crossTableEnrichment(table(meta_data$Cluster, meta_data$Batch))
devtools::load_all(".")
tl_crossTableEnrichment(table(meta_data$Cluster, meta_data$Batch))
tl_crossTableEnrichment(table(meta_data$Cluster, meta_data$Batch))
library(convgene)
devtools::load_all(".")
library(convgene)
tl_crossTableEnrichment(table(meta_data$Cluster, meta_data$Batch))
library(convgene)
tl_crossTableEnrichment(table(meta_data$Cluster, meta_data$Batch))
library(convgene)
tl_crossTableEnrichment(table(meta_data$Cluster, meta_data$Batch))
tl_crossTableEnrichment(table(meta_data$Cluster, meta_data$Batch))
library(convgene)
tl_crossTableEnrichment(table(meta_data$Cluster, meta_data$Batch))
devtools::load_all(".")
print(load("./testdata.Rdata"))
print(load("tests/testthat/testdata.Rdata"))
expect_error(pl_crossTableHeatmap(table(meta_data$Cluster, meta_data$Batch)), NA)
save(data, meta_data, features,group_by, ec_cluster_color, file = "tests/testthat/testdata.Rdata")
expect_error(pl_crossTableHeatmap(table(meta_data$Cluster, meta_data$Batch)), NA)
library(convgene)
expect_error(pl_crossTableHeatmap(table(meta_data$Cluster, meta_data$Batch)), NA)
library(convgene)
expect_error(pl_crossTableHeatmap(table(meta_data$Cluster, meta_data$Batch)), NA)
expect_error(tl_crossTableEnrichment(table(meta_data$Cluster, meta_data$Batch)), NA)
expect_error(pl_averageHeatmap(data, features, group_by, groups = c("brEC","unEC",'liEC'), show_rownames = T), NA)
expect_error(pl_dotplot(data, features, group_by, groups = c("brEC","unEC",'liEC')), NA)
expect_error(pl_averageHeatmap(data, features, group_by, groups = c("brEC","unEC",'liEC'), show_rownames = T), NA)
test_file("tests/testthat/test-pl.R")
test_file("tests/testthat/test-pl.R")
devtools::load_all(".")
test_file("tests/testthat/test-pl.R")
expect_error(pl_vioboxplot(cbind(meta_data, t(data[features,])), "Cluster", "PECAM1"), NA)
library(convgene)
test_file("tests/testthat/test-pl.R")
library(convgene)
library(convgene)
test_file("tests/testthat/test-pl.R")
test_file("tests/testthat/test-pl.R")
test_file("tests/testthat/test-pl.R")
library(convgene)
library(convgene)
test_file("tests/testthat/test-pl.R")
test_file("tests/testthat/test-pl.R")
test_file("tests/testthat/test-pl.R")
library(convgene)
test_file("tests/testthat/test-pl.R")
library(convgene)
library(convgene)
devtools::load_all(".")
expect_error(pl_stackedViolinPlot(data, features, group_by, groups = c("brEC","unEC",'liEC')), NA)
pl_stackedViolinPlot(data, features, group_by, groups = c("brEC","unEC",'liEC'))
factor(c("A", "B", "A"), levels = c("A","B", "C"))
unique(factor(c("A", "B", "A"), levels = c("A","B", "C")))
devtools::load_all(".")
write_genesToMeatascape(1:5, c(1,1,1,2,2), txt_file = "clipboard")
devtools::load_all(".")
write_genesToMeatascape(1:5, c(1,1,1,2,2), txt_file = "clipboard")
library(convgene)
pl_vioboxplot(cbind(meta_data, t(data[features,])), "Cluster", "PECAM1")
library(convgene)
use_version()
